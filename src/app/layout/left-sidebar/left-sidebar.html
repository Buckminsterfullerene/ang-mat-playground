<!-- Mobile Overlay backdrop -->
@if (leftSidebarState.isOpen() && breakpoint.isMobile()) {
  <div class="overlay" (click)="toggleSidebar()"></div>
}

<aside [class.mobile-open]="leftSidebarState.isOpen() && breakpoint.isMobile()">
  <nav class="sidebar" [class.close]="!leftSidebarState.isOpen()">
    <div>
      <!--      @if (leftSidebarState.isOpen() && !breakpoint.isMobile()) {-->
      <!--        <span class="logo">Left Menu</span>-->
      <!--      }-->
      <!-- Bind click event to the toggle method -->
      <button (click)="toggleSidebar()" class="toggle-btn" [class.rotate]="!leftSidebarState.isOpen()">
        <!-- Use Material Icon for the toggle button -->
        <mat-icon aria-hidden="true" class="material-symbols-outlined" fontIcon="keyboard_double_arrow_left"/>
      </button>
    </div>

    <ul>
      <!-- Loop through all navigation items -->
      @for (item of navItems; track item.label) {
        <li>
          <!-- links -->
          @if (item.link) {
            <!-- Conditionally render an external or internal link -->
            @if (item.external) {
              <!-- External Link: use a standard anchor tag -->
              <a
                [href]="item.link"
                target="_blank"
                rel="noopener noreferrer"
                class="external-link"
              >
                <mat-icon aria-hidden="true" class="material-symbols-outlined" [fontIcon]="item.icon"
                          aria-label="{{ item.label }} icon"/>
                <!-- Show link text if sidebar is open -->
                @if (leftSidebarState.isOpen()) {
                  <span>{{ item.label }}</span>
                }
              </a>
            } @else {
              <!-- Internal Link: use routerLink directive -->
              <a [routerLink]="item.link" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
                <mat-icon aria-hidden="true" class="material-symbols-outlined" [fontIcon]="item.icon"
                          aria-label="{{ item.label }} icon"/>
                <!-- Show link text if sidebar is open -->
                @if (leftSidebarState.isOpen()) {
                  <span>{{ item.label }}</span>
                }
              </a>
            }
          }

          <!-- items with sub-menus (dropdowns) -->
          @if (item.subItems) {
            <!-- Dropdown button to toggle sub-menu -->
            <button (click)="toggleSubMenu(item)" class="dropdown-btn" [class.rotate]="isSubMenuOpen(item.label)">
              <!-- Main icon for the parent dropdown item -->
              <mat-icon aria-hidden="true" class="material-symbols-outlined" [fontIcon]="item.icon"
                        aria-label="{{ item.label }} icon"/>
              <!-- Show link text if sidebar is open -->
              @if (leftSidebarState.isOpen()) {
                <span>{{ item.label }}</span>
              }
              <!-- Dropdown arrow icon (rotate handles the arrow direction) -->
              <mat-icon aria-hidden="true" class="material-symbols-outlined" fontIcon="keyboard_arrow_down"
                        aria-label="Toggle Submenu"></mat-icon>
            </button>

            <!-- Sub-menu container with dynamic class for 'show'/'hide' state -->
            <ul class="sub-menu" [class.show]="isSubMenuOpen(item.label)">
              <div>
                <!-- Loop through sub-menu items -->
                @for (subItem of item.subItems; track subItem.label) {
                  <li class="sub-item">
                    <!-- Conditionally render sub-item links -->
                    @if (subItem.external) {
                      <a
                        [href]="subItem.link"
                        target="_blank"
                        rel="noopener noreferrer"
                        class="external-link"
                      >
                        <!-- Sub-item icons are optional but good practice -->
                        <mat-icon aria-hidden="true" class="material-symbols-outlined" [fontIcon]="subItem.icon"
                                  aria-label="{{ subItem.label }} icon"/>
                        <!-- Show link text if sidebar is open -->
                        @if (leftSidebarState.isOpen()) {
                          <span>{{ subItem.label }}</span>
                        }
                      </a>
                    } @else {
                      <a [routerLink]="subItem.link" routerLinkActive="active"
                         [routerLinkActiveOptions]="{ exact: true }">
                        <!-- Sub-item icons are optional but good practice -->
                        <mat-icon aria-hidden="true" class="material-symbols-outlined" [fontIcon]="subItem.icon"
                                  aria-label="{{ subItem.label }} icon"/>
                        <!-- Show link text if sidebar is open -->
                        @if (leftSidebarState.isOpen()) {
                          <span>{{ subItem.label }}</span>
                        }
                      </a>
                    }
                  </li>
                }
              </div>
            </ul>
          }
        </li>
      }
    </ul>
  </nav>
</aside>
